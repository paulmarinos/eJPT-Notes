# Table of contents

- [Introduction to Exploitation](#1)
- [Vulnerability Scanning](#2)
  - [Banner grabbing](#2.1)
  - [A deeper look into Nmap NSE Scripts](#2.2)
  - [Vulnerability Scanning with Metasploit](#2.3)
- [Exploitation](#3)
  - [Exploits... and where to find them.](#3.1)
  - [The CLI Tool](#3.2)
  - [Fixing Exploits](#3.3)
- [Shells](#4)
  - [Bind Shells](#4.1)
  - [Reverse Shells](#4.2)
- [Frameworks](#5)
  - [Metasploit Framework](#5.1)
  - [Powershell Empire (from BC-SECURITY)](#5.2)
  - [RevShells](#5.3)
  - [RouterSploit](#5.4)

<a id=1></a>
# Introduction to Exploitation

Exploitation consists of techniques and tools used by an adversarie and penetration testers to gain an initial
foothold onto a system. 

Successful exploitaiton will heavily depend on information gathering and enumeration. "We can only exploit a target
if we know what is vulnerable."

We've seen automated attacks using Metasploit and other tools, but we haven't tried to really understand what exploitation
and its methodology is. In this section, we will get a better picture of that :)

We will use the PTES (Penetration Testing Execution Standard). Thus, we will follow the follow attack schema:

1. Information Gathering
2. Enumeration.
3. Exploitation.
4. Post-exploitation.
	4.1 Privilege escalation.
	4.2 Mantaining persistent access.
	4.3 Clearing tracks

The exploitation phase and its methodology consist on the following:

- Identify vulnerable services.
- Identify, find or create exploit code.
- Gain access
	- Automated - via frameworks.
	- Manually.
- Bypass AV detection.
- Pivot.
- Profit!!! :)

<a id=2></a>
# Vulnerability scanning

<a id=2.1></a>
## Banner Grabbing

Banner grabbing is the process of connecting to a service to grab a piece of information called banner. Many services
tend to present themselves to the user, although most of the time this is considered a vulnerability.

If an Apache server tells you its exact version (and sometimes the distro its running on) that's a huge vulnerability that
can (and will) be exploited either by a malicious actor or by a pentester.

The most used banner grabbing technique is via the use of Netcat. Let's try it.

```bash
$ nc -v [TARGET_ADDRESS] [PORT]
# the netcat binary might be different. ncat, nc/GNU, nc/BSD and other version exist, so do be careful.
# some versions of netcat allow us to execute a command when a target establishes a connection with us
# (reverse shell), so the techniques may vary.
$ nmap --script=banner [TARGET] -p [PORT]
# this is another banner grabbing technique :)
# pro tip: you don't have an nmap binary and you dont want to upload it to a machine? fear not!
$ nc -zv [TARGET] [PORT/PORT_RANGE]
# this nc command might be used as a TCP port scanner :)
```

<a id=2.2></a>
## A deeper look into Nmap NSE Scripts

The NSE (Nmap Scripting Engine) is a powerful tool for pentesters, as it allows us to create our own custom
Nmap scripts. The NSE is mainly written in Lua, for which we'll need to learn some of it to build our own scripts.

Nevertheless, let's check the already existing Nmap scripts that come pre-packaged with it.

```bash
$ ls -l /usr/share/nmap/scripts/ | grep [SERVICE]
# a lot of scripts come with nmap, so grep the service you need to check :)
$ vim /usr/share/nmap/scripts/http-shellshock.nse
# try to give the scripts a read. get familiriazed with how they look, how they work, this way
# we'll be able to make our own ones in the future.
```

We don't need to know first hand how every script works. The Nmap documentation is thorough, and most scripts are
well documented. Custom scripts are good too, and if, say, they aren't as well documented as the official ones, you
can still look at the NSE file and check how it works.

<a id=2.3></a>
## Vulnerability Scanning with Metasploit

We've already seen vuln scanning with Metasploit, so I won't cover it here ):

<a id=3></a>
# Exploitation

<a id=3.1></a>
## Exploits... and where to find them.

Sometimes we'll have to search for an exploit - and sometimes we won't find anything, but that's for latter - and
we have to be careful on where we search.

We need to understand that we can't just download and execute scripts from wherever we want, less so if we're doing
a pentest. For that, we need to check the two most important exploit sources:

- [Exploit-DB](https://www.exploit-db.com)
- [Rapid7](https://www.rapid7.com/db/)

Check the Exploit-db. You'll find exploits, submit exploits, access the Google Hacking Database, and more.

You can also check the db from the terminal using the Searchsploit application.

You can also browse Rapid7 EDB. I prefer the Exploit-db, but to each his own :)

Github is also a source to look exploits up, but it can be dangerous. So if you do try to run a Github exploit, be
careful and try to read the code before running it.

<a id=3.2></a>
## The CLI Tool.

Sometimes we might not have access to the internet, and as a result, we must be able to find exploits
locally or somewhere else.

Fear not. For the Exploit-DB comes prepackaged in almost all pentesting distros: Kali, Parrot, Blackarch, the main ones,
they all have it.

To access the Exploit-db, we can use a tool called Searchsploit.

```bash
$ searchsploit -u
# update the db
$ searchsplit [QUERY]
# search stuff
$ searchsploit -m [ID]
# copy a file from the db to the current working directory
$ searchsploit -c [CASE_SENSITIVE_QUERY]
# not very useful, but available :)
$ searchsploit -e [QUERY]
# this is an exact match query.
$ searchsploit [LOCAL/REMOTE] [PLATFORM] [SERVICE]
# "advanced" query. useful to delimit the exploits that can appear :)
```

<a id=3.3></a>
## Fixing Exploits

Download or copy an exploit and read it. Get familiar with it. Check the Rejetto RCE exploit, for example. You will have to
fix some parts to make it work on your own machine.
